/*******************************************************************************************************************************//**
 *
 * @file		DR_sensorInfrarojo.c
 * @brief		Modulo para el manejo sensor infrarojo IC tcrt500
 * @date		25/02/21
 * @author		Luis Gindre
 *
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** INCLUDES
 **********************************************************************************************************************************/
#include "DR_sensorInfrarojo.h"

#include "Pin.h"
#include "Gpio.h"

/***********************************************************************************************************************************
 *** DEFINES
 **********************************************************************************************************************************/
#define MAX_SENSORS 3

/***********************************************************************************************************************************
 *** TIPO DE DATOS PRIVADOS
 **********************************************************************************************************************************/
typedef struct
{
	uint8_t port;
	uint8_t pin;
	bool status;
}CNY70_t;

/***********************************************************************************************************************************
 *** VARIABLES GLOBALES PRIVADAS
 **********************************************************************************************************************************/
CNY70_t sensor[] ={{1, 27, 0},{3,25,0},{4,29,0}};

/***********************************************************************************************************************************
 *** PROTOTIPOS DE FUNCIONES
 **********************************************************************************************************************************/
void sensorInfrarojo_init()
{
	for(int i = 0; i < MAX_SENSORS; i++) {
		Pin_SetFunction_v2(sensor[i].port, sensor[i].pin, DEFAULT_FUNC);
		Pin_SetResistorMode_v2(sensor[i].port, sensor[i].pin, RES_PULL_UP);
		Pin_SetOpenDrainMode_v2(sensor[i].port, sensor[i].pin, NOT_OPEN_DRAIN);
		Gpio_SetDir(sensor[i].port, sensor[i].pin, DIR_IN);
	}
}

void sensorInfrarojo_update()
{
	for(int i = 0; i < MAX_SENSORS; i++) {
		sensor[i].status = (Gpio_GetPinValue(sensor[i].port, sensor[i].pin));
	}
}

bool getRightSensorStatus()  	{ return sensor[0].status;}
bool getMiddleSensorStatus() 	{ return sensor[1].status;}
bool getLeftSensorStatus() 		{ return sensor[2].status;}

/***********************************************************************************************************************************
 *** FIN DEL MODULO
 **********************************************************************************************************************************/
